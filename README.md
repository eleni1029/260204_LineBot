# LINE ç¾¤èŠç›£æ§èˆ‡å®¢æœç®¡ç†ç³»çµ±

å¤šæ¸ é“ï¼ˆLINE / é£›æ›¸ï¼‰ç¾¤çµ„è¨Šæ¯ç›£æ§ã€æ™ºèƒ½å•ç­”è¿½è¹¤èˆ‡ AI åˆ†æç³»çµ±ã€‚

## âœ¨ åŠŸèƒ½ç‰¹è‰²

### ğŸ“± å¤šæ¸ é“æ•´åˆ
- **LINE æ•´åˆ**ï¼šWebhook æ¥æ”¶ç¾¤çµ„/ç§èŠè¨Šæ¯
- **é£›æ›¸æ•´åˆ**ï¼šæ”¯æ´é£›æ›¸ç¾¤çµ„è¨Šæ¯èˆ‡çŸ¥è­˜åº«åŒæ­¥

### ğŸ¤– AI æ™ºèƒ½åˆ†æ
- **å•é¡Œè­˜åˆ¥**ï¼šè‡ªå‹•è­˜åˆ¥å®¢æˆ¶æå•
- **æƒ…ç·’åˆ†æ**ï¼šåˆ¤æ–·å®¢æˆ¶æƒ…ç·’ï¼ˆæ­£é¢/ä¸­æ€§/è² é¢ï¼‰
- **å»ºè­°å›è¦†**ï¼šAI ç”Ÿæˆå›è¦†å»ºè­°
- **å¤š Provider æ”¯æ´**ï¼šGemini / Claude / Ollama

### ğŸ“š çŸ¥è­˜åº«èˆ‡è‡ªå‹•å›è¦†
- **RAG èªç¾©æœå°‹**ï¼šå‘é‡ Embedding + é¤˜å¼¦ç›¸ä¼¼åº¦
- **è‡ªå‹•å›è¦†**ï¼šæ ¹æ“šçŸ¥è­˜åº«è‡ªå‹•å›ç­”å¸¸è¦‹å•é¡Œ
- **å¤šä¾†æºåŒ¯å…¥**ï¼šæ‰‹å‹•æ–°å¢ / æª”æ¡ˆä¸Šå‚³ / é£›æ›¸åŒæ­¥
- **æª”æ¡ˆæ ¼å¼æ”¯æ´**ï¼šPDFã€DOCXã€XLSXã€CSVã€Markdownã€TXT

### ğŸ“Š å®¢æœç®¡ç†
- **å•é¡Œè¿½è¹¤**ï¼šå®Œæ•´ç‹€æ…‹æµç¨‹ï¼ˆå¾…è™•ç†â†’å·²å›è¦†â†’å·²è§£æ±ºï¼‰
- **SLA ç®¡ç†**ï¼šè‡ªå‹•è¿½è¹¤å›è¦†æ™‚æ•ˆï¼Œè¶…æ™‚å‘Šè­¦
- **å®¢æˆ¶ç®¡ç†**ï¼šç¶å®šå®¢æˆ¶èˆ‡ç¾¤çµ„é—œä¿‚
- **æˆå“¡ç®¡ç†**ï¼šè­˜åˆ¥å®¢æœäººå“¡èˆ‡å¤–éƒ¨ç”¨æˆ¶

### ğŸ” ç³»çµ±ç®¡ç†
- **RBAC æ¬Šé™**ï¼šè§’è‰²èˆ‡æ¬Šé™ç²¾ç´°æ§åˆ¶
- **æ´»å‹•æ—¥èªŒ**ï¼šå®Œæ•´æ“ä½œå¯©è¨ˆè»Œè·¡
- **OAuth èªè­‰**ï¼šæ”¯æ´ Gemini CLI / Claude Code OAuth

## ğŸ—ï¸ æŠ€è¡“æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Web ç®¡ç†å¾Œå° (React + Ant Design)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              API ä¼ºæœå™¨ (Fastify)                 â”‚
â”‚         JWT èªè­‰ â”‚ RBAC â”‚ æ´»å‹•æ—¥èªŒ                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Webhook    â”‚   æ¥­å‹™é‚è¼¯    â”‚    AI æœå‹™         â”‚
â”‚  LINE/é£›æ›¸   â”‚  çŸ¥è­˜åº«/åˆ†æ   â”‚  Gemini/Claude    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         PostgreSQL + Prisma ORM                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| å±¤ç´š | æŠ€è¡“ |
|------|------|
| å¾Œç«¯æ¡†æ¶ | Fastify 4.x + TypeScript |
| å‰ç«¯æ¡†æ¶ | React 18 + Vite 5 + TypeScript |
| UI çµ„ä»¶åº« | Ant Design 5.x |
| è³‡æ–™åº« | PostgreSQL 16 |
| ORM | Prisma 5.x |
| AI Provider | Gemini OAuth / Claude Code OAuth / API Key / Ollama |
| å‘é‡æœå°‹ | Gemini Embedding (3072 ç¶­) |
| å®¹å™¨åŒ– | Docker Compose |

## ğŸš€ å¿«é€Ÿé–‹å§‹

### å‰ç½®éœ€æ±‚

- Node.js 18+
- Docker & Docker Compose
- PostgreSQL 16ï¼ˆæˆ–ä½¿ç”¨ Dockerï¼‰

### 1. Clone å°ˆæ¡ˆ

```bash
git clone https://github.com/eleni1029/260204_LineBot.git
cd 260204_LineBot
```

### 2. å•Ÿå‹•è³‡æ–™åº«

```bash
docker-compose up -d
```

### 3. å®‰è£ä¾è³´

```bash
npm install
```

### 4. è¨­å®šç’°å¢ƒè®Šæ•¸

```bash
cp packages/server/.env.example packages/server/.env
```

ç·¨è¼¯ `.env` æª”æ¡ˆï¼Œè¨­å®šå¿…è¦çš„ç’°å¢ƒè®Šæ•¸ï¼š

```bash
# å¿…é ˆè¨­å®š
DATABASE_URL="postgresql://postgres:postgres@localhost:5432/line_monitor"
JWT_SECRET="your-secret-key-change-in-production"

# AI Providerï¼ˆé¸æ“‡ä¸€ç¨®ï¼‰
AI_PROVIDER=gemini-oauth  # æˆ– claude-code-oauth / gemini / claude / ollama
```

### 5. è³‡æ–™åº«åˆå§‹åŒ–

```bash
# åŸ·è¡Œè³‡æ–™åº«é·ç§»
npm run db:migrate

# åˆå§‹åŒ–ç¨®å­æ•¸æ“šï¼ˆåŒ…å«é è¨­ç®¡ç†å“¡å¸³è™Ÿï¼‰
npm run db:seed
```

### 6. å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨

```bash
# åŒæ™‚å•Ÿå‹•å‰å¾Œç«¯
npm run dev

# æˆ–åˆ†åˆ¥å•Ÿå‹•
npm run dev:server  # å¾Œç«¯ http://localhost:3000
npm run dev:web     # å‰ç«¯ http://localhost:5173
```

### 7. ç™»å…¥ç³»çµ±

æ‰“é–‹ç€è¦½å™¨è¨ªå• http://localhost:5173

- **å¸³è™Ÿ**: `admin`
- **å¯†ç¢¼**: `admin123`

> âš ï¸ è«‹åœ¨æ­£å¼ç’°å¢ƒä¸­æ›´æ”¹é è¨­å¯†ç¢¼

## ğŸ“ å°ˆæ¡ˆçµæ§‹

```
260204_LineBot/
â”œâ”€â”€ docker-compose.yml      # Docker é…ç½®
â”œâ”€â”€ package.json            # æ ¹ packageï¼ˆnpm workspacesï¼‰
â”œâ”€â”€ PRD.md                  # ç”¢å“éœ€æ±‚æ–‡æª”ï¼ˆè©³ç´°ï¼‰
â”œâ”€â”€ README.md               # æœ¬æª”æ¡ˆ
â”‚
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ server/             # å¾Œç«¯ API (Fastify)
â”‚   â”‚   â”œâ”€â”€ prisma/         # è³‡æ–™åº« Schema & é·ç§»
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ routes/     # API è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ services/   # æ¥­å‹™é‚è¼¯
â”‚   â”‚   â”‚   â””â”€â”€ middlewares/# ä¸­é–“ä»¶
â”‚   â”‚   â”œâ”€â”€ .env.example    # ç’°å¢ƒè®Šæ•¸ç¯„ä¾‹
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”‚
â”‚   â””â”€â”€ web/                # å‰ç«¯ (React + Vite)
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ pages/      # é é¢çµ„ä»¶
â”‚       â”‚   â”œâ”€â”€ components/ # å…±ç”¨çµ„ä»¶
â”‚       â”‚   â”œâ”€â”€ services/   # API æœå‹™
â”‚       â”‚   â””â”€â”€ stores/     # ç‹€æ…‹ç®¡ç†
â”‚       â””â”€â”€ package.json
â”‚
â””â”€â”€ docs/                   # æ–‡æª”
```

## ğŸ”§ AI Provider é…ç½®

ç³»çµ±æ”¯æ´å¤šç¨® AI Providerï¼Œå¯åœ¨ `.env` ä¸­è¨­å®šï¼š

| Provider | é…ç½®æ–¹å¼ | èªªæ˜ |
|----------|----------|------|
| `gemini-oauth` | GCP æœå‹™å¸³è™Ÿ æˆ– `gcloud auth` | æ¨è–¦ï¼Œå…è²»é¡åº¦é«˜ |
| `claude-code-oauth` | Claude Code CLI OAuth | æ”¯æ´ Max è¨‚é–± |
| `gemini` | `GEMINI_API_KEY` | ç›´æ¥ä½¿ç”¨ API Key |
| `claude` | `CLAUDE_API_KEY` | ç›´æ¥ä½¿ç”¨ API Key |
| `ollama` | æœ¬åœ° Ollama æœå‹™ | ç§æœ‰éƒ¨ç½² |

### Gemini OAuth è¨­å®šï¼ˆæ¨è–¦ï¼‰

```bash
# æ–¹å¼ä¸€ï¼šä½¿ç”¨ Gemini CLIï¼ˆé–‹ç™¼ç’°å¢ƒï¼‰
npm install -g @anthropic-ai/gemini
gemini  # åŸ·è¡Œ OAuth ç™»å…¥

# æ–¹å¼äºŒï¼šä½¿ç”¨ GCP æœå‹™å¸³è™Ÿï¼ˆç”Ÿç”¢ç’°å¢ƒï¼‰
# 1. åœ¨ GCP Console å»ºç«‹æœå‹™å¸³è™Ÿ
# 2. ä¸‹è¼‰é‡‘é‘°æª”æ¡ˆç‚º gcp-service-account.json
# 3. è¨­å®šç’°å¢ƒè®Šæ•¸
GOOGLE_APPLICATION_CREDENTIALS=./gcp-service-account.json
GCP_PROJECT_ID=your-project-id
```

## ğŸ“¡ Webhook è¨­å®š

### LINE Webhook

1. åœ¨ [LINE Developers Console](https://developers.line.biz/) å»ºç«‹ Messaging API Channel
2. å–å¾— Channel Secret å’Œ Channel Access Token
3. åœ¨ç³»çµ±è¨­å®šé é¢å¡«å…¥ï¼Œæˆ–è¨­å®šç’°å¢ƒè®Šæ•¸
4. è¨­å®š Webhook URL: `https://your-domain/api/webhook/line`

### é£›æ›¸ Webhook

1. åœ¨ [é£›æ›¸é–‹æ”¾å¹³å°](https://open.feishu.cn/) å»ºç«‹æ‡‰ç”¨
2. å–å¾— App ID å’Œ App Secret
3. åœ¨ç³»çµ±è¨­å®šé é¢é…ç½®
4. è¨­å®š Webhook URL: `https://your-domain/api/webhook/feishu`

## ğŸ“– æ–‡æª”

- [PRD.md](./PRD.md) - å®Œæ•´ç”¢å“éœ€æ±‚æ–‡æª”ï¼ŒåŒ…å«æ‰€æœ‰åŠŸèƒ½æ¨¡çµ„çš„è©³ç´°èªªæ˜èˆ‡äº¤äº’ç´°ç¯€
- [.env.example](./packages/server/.env.example) - ç’°å¢ƒè®Šæ•¸é…ç½®èªªæ˜

## ğŸ› ï¸ é–‹ç™¼æŒ‡ä»¤

```bash
# é–‹ç™¼
npm run dev           # åŒæ™‚å•Ÿå‹•å‰å¾Œç«¯
npm run dev:server    # åƒ…å•Ÿå‹•å¾Œç«¯
npm run dev:web       # åƒ…å•Ÿå‹•å‰ç«¯

# è³‡æ–™åº«
npm run db:migrate    # åŸ·è¡Œé·ç§»
npm run db:seed       # åˆå§‹åŒ–ç¨®å­æ•¸æ“š
npm run db:studio     # æ‰“é–‹ Prisma Studio

# å»ºç½®
npm run build         # å»ºç½®å‰å¾Œç«¯
npm run lint          # ç¨‹å¼ç¢¼æª¢æŸ¥
npm run test          # åŸ·è¡Œæ¸¬è©¦
```

## ğŸ“ License

MIT

## ğŸ¤ è²¢ç»

æ­¡è¿æäº¤ Issue å’Œ Pull Requestï¼
